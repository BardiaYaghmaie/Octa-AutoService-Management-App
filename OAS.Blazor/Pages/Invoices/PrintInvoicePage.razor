@page "/printInvoice/{InvoiceId:guid}"
@using OAS.Application.Features.InvoiceFeatures.GetInvoiceReportInfo;
@using Stimulsoft.Base
@using Stimulsoft.Report
@using Stimulsoft.Report.Blazor
@using Stimulsoft.Report.Dictionary;
@inject MediatR.IMediator mediator;
<StiBlazorViewer Report="@stiReport" />
@code {
    [Parameter]
    public Guid InvoiceId { get; set; }
    class InvoiceItemModel
    {
        public string RowNumber { get; set; }
        public string Name { get; set; }
        public string Count { get; set; }
        public string UnitPrice { get; set; }
        public string TotalPrice { get; set; }
    }
    private StiReport stiReport = new();
    protected async override Task OnInitializedAsync()
    {
        Stimulsoft.Base.StiLicense.Key = "6vJhGtLLLz2GNviWmUTrhSqnOItdDwjBylQzQcAOiHl2AD0gPVknKsaW0un+3PuM6TTcPMUAWEURKXNso0e5OFPaZYasFtsxNoDemsFOXbvf7SIcnyAkFX/4u37NTfx7g+0IqLXw6QIPolr1PvCSZz8Z5wjBNakeCVozGGOiuCOQDy60XNqfbgrOjxgQ5y/u54K4g7R/xuWmpdx5OMAbUbcy3WbhPCbJJYTI5Hg8C/gsbHSnC2EeOCuyA9ImrNyjsUHkLEh9y4WoRw7lRIc1x+dli8jSJxt9C+NYVUIqK7MEeCmmVyFEGN8mNnqZp4vTe98kxAr4dWSmhcQahHGuFBhKQLlVOdlJ/OT+WPX1zS2UmnkTrxun+FWpCC5bLDlwhlslxtyaN9pV3sRLO6KXM88ZkefRrH21DdR+4j79HA7VLTAsebI79t9nMgmXJ5hB1JKcJMUAgWpxT7C7JUGcWCPIG10NuCd9XQ7H4ykQ4Ve6J2LuNo9SbvP6jPwdfQJB6fJBnKg4mtNuLMlQ4pnXDc+wJmqgw25NfHpFmrZYACZOtLEJoPtMWxxwDzZEYYfT";



        await base.OnInitializedAsync();
        //stiReport = new();
        //var inovoiceInfoObj = new
        //{
        //    CustomerName = "بردیا یغمایی",
        //    VehicleName = "206 تیپ 5 سفید",
        //    VehicleCode = "1243",
        //    InvoiceCode = "675467",
        //    InvoiceDate = "1402/05/01"
        //};

        //var invoiceItems = new List<InvoiceItemModel>
        //{
        //    new()
        //    {
        //        RowNumber = "1",
        //        Name = "روغن مکسا",
        //        Count = "24 لیتر",
        //        TotalPrice = "4500000",
        //        UnitPrice = "1000"
        //    },
        //     new()
        //    {
        //        RowNumber = "2",
        //        Name = "روغن مکسا",
        //        Count = "24 لیتر",
        //        TotalPrice = "4500000",
        //        UnitPrice = "1000"
        //    }
        //};
        //stiReport.RegData("InvoiceInfo", inovoiceInfoObj);
        //stiReport.RegData("InvoiceItem", invoiceItems);


        var request = new GetInvoiceReportInfoRequest(InvoiceId);
        var response = await mediator.Send(request);
        stiReport.RegData("InvoiceItem", response.Items);
        stiReport.RegData("InvoiceInfo", new
        {
            CustomerName = response.CustomerTitle,
            VehicleName = response.VehicleTitle,
            VehicleCode = response.VehicleCode,
            InvoiceCode = response.InvoiceCode,
            InvoiceDate = response.InvoiceDate
        });
        this.stiReport.Load("report_templates/invoice.mrt");


    }
}
