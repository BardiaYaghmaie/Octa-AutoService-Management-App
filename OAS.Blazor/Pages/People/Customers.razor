@page "/Customers"
@using OAS.Application.Features.CustomerFeatures.GetCustomers;
@inject IMediator mediator

<MudRTLProvider RightToLeft="true">

    <RadzenDataGrid Data="_customers" TItem="GetCustomersResponse_DTO" AllowVirtualization="false" Style="height:400px"
                    AllowFiltering="true" FilterPopupRenderMode="PopupRenderMode.OnDemand" FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive" LogicalFilterOperator="LogicalFilterOperator.Or"  
                      AllowSorting="true">  
          <Columns>
            <RadzenDataGridColumn TItem="GetCustomersResponse_DTO" Title="ردیف">
                <Template Context="item">  
                      @item.RowNumber.ToString().En2Fa()  
                  </Template>  
              </RadzenDataGridColumn>
            <RadzenDataGridColumn TItem="GetCustomersResponse_DTO" Title="نام و نام خانوادگی">
                <Template Context="item">
                    @(item.FirstName.ToString().En2Fa() + " " + @item.LastName.ToString().En2Fa())
                </Template>  
              </RadzenDataGridColumn>
            <RadzenDataGridColumn TItem="GetCustomersResponse_DTO" Title="کد">
                <Template Context="item">
                    @item.Code.ToString().En2Fa()
                </Template>
            </RadzenDataGridColumn>

           @*  <RadzenDataGridColumn TItem="GetCustomersResponse_DTO" Title="عملیات">
                <Template Context="item"> 
                     <RadzenButton Click=@OpenRegisterCustomer>+</RadzenButton> 
                  </Template> 
               </RadzenDataGridColumn> *@
       
          </Columns>  
      </RadzenDataGrid>  

    @*<ul>
        @foreach (var c in _customers)
        {
            <li>@c.Name -- @c.Code -- @c.Id</li>
        }
    </ul>*@
    <p class="text-danger">@error</p>

</MudRTLProvider>



@code {
    private List<GetCustomersResponse_DTO> _customers = new();
    private string error = "";

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var request = new GetCustomersRequest();
            var response = await mediator.Send(request);

            var customers = response.Data;
            _customers = customers;

        }
        catch (Exception)
        {

            error = "خطا هنگام خواندن اطلاعات";
        }
    }

}